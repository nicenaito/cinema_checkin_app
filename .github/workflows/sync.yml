name: Daily Swarm Sync

on:
  schedule:
    - cron: '0 3 * * *' # 毎日 03:00 UTC (日本時間 12:00)
  workflow_dispatch: {}

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Call sync endpoint
        env:
          DEPLOYMENT_URL: ${{ secrets.DEPLOYMENT_URL }}
          ADMIN_TOKEN: ${{ secrets.ADMIN_TOKEN }}
        run: |
          if [ -z "$DEPLOYMENT_URL" ]; then
            echo "DEPLOYMENT_URL secret is not set"; exit 1;
          fi
          curl -sS -H "x-admin-token: $ADMIN_TOKEN" "$DEPLOYMENT_URL/api/sync" | jq || true
